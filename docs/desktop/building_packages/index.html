<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.74.3" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Building packages locally | MocaccinoOS</title><meta property="og:title" content="Building packages locally" />
<meta property="og:description" content="How to build packages on MocaccinoOS with portage (or not)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.mocaccino.org/docs/desktop/building_packages/" />
<meta property="article:modified_time" content="2021-07-26T15:29:34-05:00" /><meta property="og:site_name" content="MocaccinoOS" />
<meta itemprop="name" content="Building packages locally">
<meta itemprop="description" content="How to build packages on MocaccinoOS with portage (or not)">
<meta itemprop="dateModified" content="2021-07-26T15:29:34-05:00" />
<meta itemprop="wordCount" content="926">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building packages locally"/>
<meta name="twitter:description" content="How to build packages on MocaccinoOS with portage (or not)"/>







<link rel="preload" href="/scss/main.min.3d889200f2488f966de56dc6a011ee034940f303c40ab0e3029effbb650afccc.css" as="style">
<link href="/scss/main.min.3d889200f2488f966de56dc6a011ee034940f303c40ab0e3029effbb650afccc.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>


<link rel="stylesheet" href="/termynal.css">
<script src="/termynal.js"></script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">MocaccinoOS</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/mocaccinoOS/mocaccino/issues" target="_blank" ><span>Issue tracker</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/community/" ><span>Community</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://packages.mocaccino.org" target="_blank" ><span>Packages</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/docs/contribution-guidelines/" ><span>Contribution guidelines</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/docs/donate/" ><span>Support us</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.21fd1cf228fbc16c73a56a535f829efba1780c229c5d486b4841096c9cee38429507ed2873647ad5194ac0e00e6bdf3036cccd88503d9d2aea51f66f5c12ab94.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.21fd1cf228fbc16c73a56a535f829efba1780c229c5d486b4841096c9cee38429507ed2873647ad5194ac0e00e6bdf3036cccd88503d9d2aea51f66f5c12ab94.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/desktop/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Mocaccino Desktop</a>
  </li>
  <ul>
    <li class="collapse show" id="docsdesktop">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopdownload" href="/docs/desktop/download/">Download</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopmigrating" href="/docs/desktop/migrating/">Migrating from Sabayon</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopusage" href="/docs/desktop/usage/">Luet commands</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopdocker" href="/docs/desktop/docker/">Docker</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopwhalebrew" href="/docs/desktop/whalebrew/">Whalebrew</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopappimage" href="/docs/desktop/appimage/">AppImage</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopflatpak" href="/docs/desktop/flatpak/">Flatpak</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-docsdesktopbuilding_packages" href="/docs/desktop/building_packages/">Building packages locally</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/desktop/development/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Development guidelines</a>
  </li>
  <ul>
    <li class="collapse " id="docsdesktopdevelopment">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopdevelopmenthowdoi" href="/docs/desktop/development/howdoi/">Frequent questions</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktopapache_with_docker" href="/docs/desktop/apache_with_docker/">Install Apache webserver</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdesktoprepositories" href="/docs/desktop/repositories/">Repositories</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/general/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">General</a>
  </li>
  <ul>
    <li class="collapse " id="docsgeneral">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsgeneraliso-building" href="/docs/general/iso-building/">ISO building</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsgeneralkernels" href="/docs/general/kernels/">Switching kernels</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsgeneralsystem-config" href="/docs/general/system-config/">System Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsgeneralsystem-profiles" href="/docs/general/system-profiles/">System profiles</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/micro/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Mocaccino Micro</a>
  </li>
  <ul>
    <li class="collapse " id="docsmicro">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsmicroservice-management" href="/docs/micro/service-management/">Init and Services</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsmicroinstallation" href="/docs/micro/installation/">Installation notes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsmicrobuilding-packages" href="/docs/micro/building-packages/">Building packages with Micro and k3s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsmicrodocker" href="/docs/micro/docker/">Docker</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsmicrowireguard" href="/docs/micro/wireguard/">Wireguard</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscontribution-guidelines" href="/docs/contribution-guidelines/">Contribution guidelines</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdonate" href="/docs/donate/">Support us</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            






<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











<a href="https://github.com/MocaccinoOS/website/edit/master/content/en/docs/Desktop/building_packages.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/MocaccinoOS/website/new/master/content/en/docs/Desktop/building_packages.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" target="_blank"><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/MocaccinoOS/website/issues/new?title=Building%20packages%20locally" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/MocaccinoOS/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#create-a-workspace">Create a workspace</a></li>
    <li><a href="#first-package">First package</a></li>
    <li><a href="#building-the-package">Building the package</a></li>
    <li><a href="#install-the-package">Install the package</a></li>
    <li><a href="#advanced-topics">Advanced topics</a>
      <ul>
        <li><a href="#showing-package-files">Showing package files</a></li>
        <li><a href="#find-duplicate-files-shipped-by-packages">Find duplicate files shipped by packages</a></li>
        <li><a href="#removing-generated-docker-images">Removing generated docker images</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://www.mocaccino.org/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://www.mocaccino.org/docs/desktop/">Mocaccino Desktop</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://www.mocaccino.org/docs/desktop/building_packages/">Building packages locally</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Building packages locally</h1>
    <div class="lead">How to build packages on MocaccinoOS with portage (or not)</div>
	       
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>
<p>Building packages is a complex topic. Installing packages coming from untrusted repositories, or building packages in the <em>wrong</em> way might break your system.</p>
<p>The following steps should only be carried out on test systems. Do make sure you have any important data backed up before installing any package.</p>

</div>

<p>MocaccinoOS desktop, even if based on portage, doesn&rsquo;t support the direct usage of <code>emerge</code>. Although it&rsquo;s possible to compile and install packages from portage.</p>
<p>To build a system package, instead use <code>luet build</code>. The following document tries to summarize the steps to build a package with emerge with <code>luet build</code>, and install and track it in a MocaccinoOS Desktop system, should cover the scenario: <em>&ldquo;hey, can I install packages with emerge?&quot;</em>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Be sure to have <a href="/docs/desktop/docker">docker</a> installed, and the daemon running. The document is assuming you are carrying the steps on MocaccinoOS Desktop (GNOME in the specific case).</li>
<li>At least 30G of free disk space. To reclaim the space afterwards, run <code>docker system prune --force --volumes --all</code></li>
</ul>
<p>Follow the steps described in <a href="/docs/desktop/docker">this document</a> before going ahead.</p>
<h2 id="create-a-workspace">Create a workspace</h2>
<p>First of all, let&rsquo;s create a workspace. The packages that we will build have to persist somewhere in your local system, the location must be accessible while performing a <code>luet upgrade</code>. We will use <code>/user/system_repository</code> as an example. And we will assume the commands are running as root.</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir -p /user/system_repository/tree
$ <span style="color:#24909d">cd</span> /user/system_repository
</code></pre></td></tr></table>
</div>
</div><p>All the commands from now on will be carried from the <code>/user/system_repository</code> directory.</p>
<h2 id="first-package">First package</h2>
<p>Let&rsquo;s put our eyes on, let&rsquo;s say, <a href="https://packages.gentoo.org/packages/games-board/gnome-chess">games-board/gnome-chess</a>, and create a compilation definition for it.</p>
<p>Let&rsquo;s first declare it&rsquo;s canonical name, or how you would actually install it afterwards with <code>luet</code> (e.g. <code>luet install app/gnome-chess</code>)</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir tree/gnome-chess
$ cat <span style="color:#ed9d13">&lt;&lt;EOF &gt;&gt;tree/gnome-chess/definition.yaml
</span><span style="color:#ed9d13">category: &#34;apps&#34;
</span><span style="color:#ed9d13">name: &#34;gnome-chess&#34;
</span><span style="color:#ed9d13">version: &#34;0.1&#34;
</span><span style="color:#ed9d13">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>Here the version doesn&rsquo;t really matter, it&rsquo;s mostly for you to keep it track in your system. You can decide to follow strictly the versioning from gnome-chess, or not.</p>
<p>Now let&rsquo;s get to the important part, the build definition. This tells luet how to compile your package:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat <span style="color:#ed9d13">&lt;&lt;EOF &gt;&gt;tree/gnome-chess/build.yaml
</span><span style="color:#ed9d13">package_dir: &#34;/package&#34;
</span><span style="color:#ed9d13">steps:
</span><span style="color:#ed9d13">- emerge --root /package games-board/gnome-chess
</span><span style="color:#ed9d13">requires:
</span><span style="color:#ed9d13">- category: &#34;layers&#34;
</span><span style="color:#ed9d13">  name: &#34;gnome&#34;
</span><span style="color:#ed9d13">  version: &#34;&gt;=0&#34;
</span><span style="color:#ed9d13">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>as you see, we are using emerge here to compile the package. The requires section tells from where it runs the command, which in this case is the MocaccinoOS desktop gnome layer. To see all the layers available, run <code>luet search layers</code> or to see the currently installed, you can run <code>luet search --installed layers</code>).</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>
The <code>package_dir</code> option tells luet where is the final package located. We use <code>emerge --root</code> here to specify a different location where our package is installed. We could also drop <code>package_dir</code> and <code>--root</code> from emerge and let <code>luet</code> compute the delta, but in this way it&rsquo;s faster and less I/O intensive.
</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>
Even if the example shows how to build a package with emerge, it is although possible to create packages out from any docker image - even not by compiling. You have to be careful to check if any package dependencies are actually already shipped by the layers
</div>

<p>Now let&rsquo;s add an installation hook to our package, in our specific case (gnome-chess) we need a trigger to generate glib schemas right after the package gets installed in the system:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat <span style="color:#ed9d13">&lt;&lt;EOF &gt;&gt;tree/gnome-chess/finalize.yaml
</span><span style="color:#ed9d13">install:
</span><span style="color:#ed9d13">- glib-compile-schemas /usr/share/glib-2.0/schemas
</span><span style="color:#ed9d13">EOF</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="building-the-package">Building the package</h2>
<p>Now let&rsquo;s build the packages (remember to run as root, or with <code>sudo</code> upfront):</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ luet build --tree tree --pull --pull-repository quay.io/mocaccinocache/desktop --from-repositories --live-output --only-target-package apps/gnome-chess
</code></pre></td></tr></table>
</div>
</div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>
The first time can take up some time due to downloading the images, but those are cached locally for local iteration. Time for a coffee!
</div>

<p>After build is completed, generate the repository metadata:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ luet create-repo --tree tree
</code></pre></td></tr></table>
</div>
</div><h2 id="install-the-package">Install the package</h2>
<p>First let&rsquo;s consume the repository we just created in our system:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat <span style="color:#ed9d13">&lt;&lt;EOF &gt;&gt; /etc/luet/repos.conf.d/local.yaml
</span><span style="color:#ed9d13">name: &#34;local-repository&#34;
</span><span style="color:#ed9d13">description: &#34;Local repository&#34;
</span><span style="color:#ed9d13">type: &#34;disk&#34;
</span><span style="color:#ed9d13">enable: true
</span><span style="color:#ed9d13">cached: true
</span><span style="color:#ed9d13">priority: 99
</span><span style="color:#ed9d13">urls: # Repository URLs
</span><span style="color:#ed9d13">  - /user/system_repository/build
</span><span style="color:#ed9d13">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we are ready to install <code>gnome-chess</code> locally:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ luet install apps/gnome-chess
</code></pre></td></tr></table>
</div>
</div><h2 id="advanced-topics">Advanced topics</h2>
<h3 id="showing-package-files">Showing package files</h3>
<p>Luet shows already all the files shipped by a package with <code>luet search</code>. For example:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ luet search apps/gnome-chess -o yaml
</code></pre></td></tr></table>
</div>
</div><h3 id="find-duplicate-files-shipped-by-packages">Find duplicate files shipped by packages</h3>
<p>You can check duplicate files into the package shipped by repositories, also before installing them:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">luet search -o json | luet filter
</code></pre></td></tr></table>
</div>
</div><p>This is particularly useful to check for any conflicting files with the system packages and the ones you are generating.</p>
<p>See also the <a href="/docs/desktop/development/howdoi/#how-do-i-find-the-duplicate-files-in-the-package-repositories">dev section</a> regarding duplicate files.</p>
<h3 id="removing-generated-docker-images">Removing generated docker images</h3>
<p>By default, images are tagged under <code>luet/cache</code>. So it&rsquo;s possible to remove all the cache images generated by removing the <code>luet/cache</code> and <code>quay.io/mocaccinocache/desktop</code> images, although, you should also prune afterwards the images not referenced anymore by any tag with <code>docker image prune</code>:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker images --filter=<span style="color:#ed9d13">&#39;reference=luet/cache&#39;</span> --format=<span style="color:#ed9d13">&#39;{{.Repository}}:{{.Tag}}&#39;</span> | xargs -r docker rmi
$ docker images --filter=<span style="color:#ed9d13">&#39;reference=quay.io/mocaccinocache/desktop&#39;</span> --format=<span style="color:#ed9d13">&#39;{{.Repository}}:{{.Tag}}&#39;</span> | xargs -r docker rmi
$ docker image prune
</code></pre></td></tr></table>
</div>
</div><p>A way to reclaim all the space occupied by docker more aggressively is by running <code>docker system prune</code>, but attention, this command will remove all the images, also the ones which weren&rsquo;t generated by <code>luet</code>:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker system prune --force --volumes --all
</code></pre></td></tr></table>
</div>
</div><h2 id="references">References</h2>
<ul>
<li><a href="https://luet-lab.github.io/docs">Luet docs</a></li>
<li><a href="https://luet-lab.github.io/docs/docs/concepts/packages/">Luet Packages</a></li>
<li><a href="https://luet-lab.github.io/docs/docs/tutorials/hello_world/">Luet hello world</a></li>
<li><a href="https://github.com/Luet-lab/examples/tree/master/demo3/tree">Emerge ebuild example</a></li>
</ul>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified July 26, 2021: <a  href="https://github.com/MocaccinoOS/website/commit/091f9283a989ed8510239064f125f16ecfa8d0e7">Update iso-building.md (091f928)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Forum" aria-label="Forum">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://community.mocaccino.org/">
      <i class="fab fa-discourse"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Telegram" aria-label="Telegram">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://t.me/mocaccinoOS">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://twitter.com/MocaccinoOs">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/luet/shared_invite/enQtOTQxMjcyNDQ0MDUxLWQ5ODVlNTI1MTYzNDRkYzkyYmM1YWE5YjM0NTliNDEzNmQwMTkxNDRhNDIzM2Y5NDBlOTZjZTYxYWQyNDE4YzY">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/MocaccinoOS">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/luet/shared_invite/enQtOTQxMjcyNDQ0MDUxLWQ5ODVlNTI1MTYzNDRkYzkyYmM1YWE5YjM0NTliNDEzNmQwMTkxNDRhNDIzM2Y5NDBlOTZjZTYxYWQyNDE4YzY">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 MocaccinoOS org. All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/js/main.min.460c8ae21829f9b330823a08f34ac961d7d0daa8874c8c9eba7ea0484bb42a79.js" integrity="sha256-RgyK4hgp&#43;bMwgjoI80rJYdfQ2qiHTIyeun6gSEu0Knk=" crossorigin="anonymous"></script>




  </body>
</html>